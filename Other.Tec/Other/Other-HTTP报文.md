#### HTTP报文

##### 0X01 报文

##### 0X01.1 报文流

1. HTTP报文是在HTTP应用程序之间发送的数据块。
2. HTTP使用术语流入和流出来描述事务处理的方向。报文流入源端服务器，工作完成后，会流回用户的Agent代理中。
3. 不管是请求报文还是响应报文，所有报文都会向下游流动。所有报文的发送者都在接受者的上游。

##### 0X01.2 报文的组成部分

1. 组成：对报文进行描述的起始行、包含属性的首部块、包含数据的主体部分。

2. 起始行和首部就是由行分隔的ASCII文本。每行都是一个由两个字符组成的行终止序列作为结束，其中包括一个回车符和一个换行符。可以写作:CRLF

3. 实体的主体或报文的主体是一个可选的数据块。与起始行和首部不同的是，主题中可以包含文本或二进制数据，也可以为空。

4. 报文的语法：

   * 请求报文的格式：

     * ```
       <method> <request-URL> <version>
       <headers>

       <entity-body>
       ```

   * 响应报文的格式：

     * ```
       <version> <status> <reason-phrase>
       <headers>

       <entity-body>
       ```

5. 语法说明：

   * 版本：报文所使用的HTTP版本，格式：HTTP/<major>.<minor>
   * 原因短语：数字状态码的可读版本，包含行终止序列之前的所有文本。
   * 首部：可以有零个或多个首部，每个首部都包含一个名字，后面跟一个冒号，然后是一个可选的空格，接着是一个值，最后是一个CRLF。首部是由一个空行结束的，表示了首部列表的结束和实体主体部分的开始。
   * 实体的主体部分：实体的主体部分包含一个由任意数据组成的数据块。并不是所有的报文都包含实体的主体部分。

6. 起始行

   * 所有的HTTP报文都以一个起始行作为开始。请求报文的起始行说明了要做些什么。响应报文的起始行说明了发生了什么。
   * 请求行：请求报文请求服务器对资源进行一些操作。
   * 响应行：响应报文承载了状态信息和操作产生的所有结果数据，将其返回给客户端。所有字段都由空格符进行分隔。
   * 状态码：
     * 100~199/100~101 信息提示
     * 200~299/200~206 成功
     * 300~399/300~305 重定向
     * 400~499/400~415 客户端错误
     * 500~599/500~505 服务器错误
     * 301：在请求的URL已被移除时使用。响应的Location首部中应该包含资源现在所处的URL。原因短语：Moved Permanently
     * 302：与301类似，但是，客户端应该使用Location首部给出的URL来临时定位资源。将来的请求仍应使用老的URL。原因短语：Found
     * 307：与301状态码类似，但客户端应该使用Location给出的URL来临时定位资源。将来的请求应该使用老的URL。原因短语：Temporary Redirect

7. 首部

   * 分类：
     * 通用首部：既可以出现在请求报文中，也可以出现在响应报文中。
     * 请求首部：提供更多有关请求的信息。
     * 响应首部：提供更多有关响应的信息。
     * 实体首部：描述主体的长度和内容，或者资源自身。

##### 0X02 首部

1. 通用首部：
   * Connection：允许客户端和服务器指定与请求/响应连接有关的选项
   * Date：提供日期和时间标志，说明报文是什么时间创建的
   * Update：给出了发送端可能想要“升级”使用的新版本或协议
   * Via：显示了报文经过的中间节点(代理、网关)
   * Cache-Control：用于随报文传送缓存指示
   * Pragma：另一种随报文传送指示的方式，但并不专用于缓存
2. 请求首部：
   * Client-IP：提供了运行客户端的机器的IP地址
   * From：提供了客户端用户的Email地址
   * Host：给出了接收请求的服务器的主机名和端口号
   * Referer：提供了包含当前请求URI的文档的URL
   * User-Agent：将发起请求的应用程序名称告知服务器
   * Accept：告诉服务器能够发送那些媒体类型
   * Accept-Encoding：告诉服务器能够发送哪些编码方式
   * 条件请求首部：
     * EXcept：允许客户端列出某请求要求的服务器行为
     * If-Match：如果实体标记与文档当前的实体标记相匹配，就获取这份文档
     * If-Modified-Since：除非在某个指定的日期之后资源被修改过，否则就限制这个请求。
     * If-None-Match：如果提供的实体标记与当前文档的实体标记不符，就获取文档。
   * 安全请求首部：
     * Authorization：包含了客户端提供给服务器，以便对其自身进行认证的数据。
     * Cookie：客户端用它向服务器传送一个令牌
3. 响应首部：
   * Age：从最初创建开始响应持续时间。
   * Server：服务器应用程序软件的名称和版本。
   * 安全响应首部：
     * Set-Cookie：可以在客户端设置一个令牌，以便服务器对客户端进行标识。
4. 实体首部：
   * Allow：列出了可以对此实体执行的请求方法。
   * Location：告知客户端实体实际上位于何处，用于将接收端定向到资源的位置（URL）上去。
   * 内容首部：
     * Content-Encoding：对主体执行的任意编码方式
     * Content-Language：理解主体时最适宜使用的自然语言
     * Content-Length：主体的长度或尺寸
     * Content-Type：这个主体的对象类型
   * 实体缓存首部：
     * ETag：与此实体相关的实体标记
     * Expires：实体不再有效，要从原始的源端再次获取此实体的日期和时间
     * Last-Modified：这个实体最后一次被修改的日期和时间