#### 缓存更新的策略

> 缓存更新的策略主要有两种:被动失效和主动更新.

1. 被动失败:
   * 一般来说缓存数据主要是服务读请求的,并设置一个过期的时间;或者当数据库状态改变时,通过delete,是数据失效掉.当下次再进行读取时,发现数据失效,则再到持久层中读取对缓存进行更新.
   * 缺点: 
     * 缓存失效后会击穿缓存,读请求落在持久层中.这对大访问量的系统来说是有很大风险的.
     * 过期时间不能一致,需要随机设置.
   * ​
2. 主动更新:
   * 当缓存失效时,需要主动更新缓存.
   * 缺点:
     * 存在并发读写的问题,会造成脏数据的存在.
       * 锁控制:这种方式一般在客户端实现.任何进程要调用写方法时,先要获取一个排他锁,阻塞住所有的其他访问,等修改完再释放.如果遇到其他的进程需要修改,需要进行等待.
       * 版本控制: 单版本控制+多版本控制.
       * 单版本控制: 为每份数据保存一个版本号，当缓存数据写入时，需要传入这个版本号，然后服务端将传入的版本号和数据当前的版本号进行比对，如果大于当前版本，则成功写入，否则返回失败.
       * 多版本控制: 存储系统为每个数据保存多份，每份都有自己的版本号，互不冲突，然后通过一定的策略来定期合并，再或者就是交由客户端自己去选择读取哪个版本的数据。